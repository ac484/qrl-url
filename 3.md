ç¼ºå°‘QRL/USDT å°ˆå±¬æª”æ¡ˆ
1. **ç¡¬ç·¨ç¢¼ QRL/USDTï¼ˆä¸èƒ½å‚³ symbolï¼‰**
2. **é›†ä¸­é¢¨æ§é‚è¼¯**
3. **ç¦æ­¢é‡ç”¨æ–¼å…¶ä»–å¹£**

---

# ğŸŸ¢ Domainï¼ˆQRL çš„ã€Œä¸å¯è®Šè¦å‰‡ã€ï¼‰

## 1ï¸âƒ£ åƒ¹æ ¼ï¼ˆPriceï¼‰

```
domain/value_objects/
 â””â”€ qrl_price.py      
```

è²¬ä»»ï¼š

* åƒ¹æ ¼ precisionï¼ˆQRL/USDTï¼‰
* æœ€å°è®Šå‹•ï¼ˆtick sizeï¼‰
* ç¦æ­¢è² æ•¸ / 0

```python
class QrlPrice(Price):
    TICK_SIZE = Decimal("0.0001")
```

---

## 2ï¸âƒ£ æ•¸é‡ï¼ˆQuantityï¼‰

```
domain/value_objects/
 â””â”€ qrl_quantity.py    
```

è²¬ä»»ï¼š

* æœ€å°ä¸‹å–®é‡
* step size
* é˜²æ­¢ fat finger

---

## 3ï¸âƒ£ äº¤æ˜“å°ï¼ˆTrading Pairï¼‰

```
domain/value_objects/
 â””â”€ qrl_usdt_pair.py   
```

```python
SYMBOL = "QRLUSDT"
BASE = "QRL"
QUOTE = "USDT"
```

ğŸ“Œ ç¦æ­¢ runtime å»ºæ§‹

---

# ğŸŸ¢ Applicationï¼ˆQRL è¡Œç‚ºï¼‰

## 4ï¸âƒ£ åƒ¹æ ¼å–å¾—ï¼ˆè¡Œæƒ…ï¼‰

```
application/market/qrl/
 â”œâ”€ get_qrl_price.py    
 â”œâ”€ get_qrl_depth.py    
 â””â”€ get_qrl_kline.py    
```

ğŸ“Œ é€™è£¡åšï¼š

* åƒ¹æ ¼æ­£è¦åŒ–
* WS / REST fallback

---

## 5ï¸âƒ£ ä¸‹å–®ï¼ˆæ ¸å¿ƒï¼‰

```
application/trading/qrl/
 â”œâ”€ place_qrl_order.py   
 â”œâ”€ cancel_qrl_order.py  
 â””â”€ get_qrl_order.py     
```

`place_qrl_order.py` ä¸€å®šè¦ï¼š

* ä½¿ç”¨ `QrlPrice`
* ä½¿ç”¨ `QrlQuantity`
* ä½¿ç”¨ `QrlUsdtPair`
* èµ° Guard chain

---

## 6ï¸âƒ£ Guardï¼ˆä¿å‘½ï¼‰

```
application/trading/qrl/guards/
 â”œâ”€ qrl_balance_guard.py
 â”œâ”€ qrl_price_guard.py
 â”œâ”€ qrl_duplicate_guard.py
 â””â”€ qrl_rate_limit_guard.py
```

---

# ğŸŸ¢ Infrastructureï¼ˆQRL â†” MEXCï¼‰

## 7ï¸âƒ£ API Clientï¼ˆSymbol å°æ­»ï¼‰

```
infrastructure/exchange/mexc/qrl/
 â”œâ”€ qrl_rest_client.py   
 â”œâ”€ qrl_ws_client.py     
 â””â”€ qrl_settings.py      
```

ğŸ“Œ ä¸æ¥å— symbol åƒæ•¸

---

## 8ï¸âƒ£ Mapperï¼ˆQRL å°ˆç”¨ï¼‰

```
infrastructure/exchange/mexc/qrl/
 â”œâ”€ qrl_price_mapper.py
 â”œâ”€ qrl_order_mapper.py
 â””â”€ qrl_trade_mapper.py
```

---

## 9ï¸âƒ£ WS ç‹€æ…‹ç®¡ç†

```
infrastructure/exchange/mexc/qrl/ws/
 â”œâ”€ qrl_stream_state.py
 â”œâ”€ qrl_snapshot_loader.py
 â””â”€ qrl_reconnect_policy.py
```

---

# ğŸŸ¢ Interfacesï¼ˆæ§åˆ¶é¢ï¼‰

## ğŸ”Ÿ Dashboardï¼ˆå”¯è®€ï¼‰

```
interfaces/http/pages/
 â”œâ”€ dashboard_routes.py   âœ… å·²æœ‰
 â””â”€ templates/dashboard/index.html
```

ğŸ“Œ åƒ…é¡¯ç¤ºï¼š

* QRL åƒ¹æ ¼
* QRL å€‰ä½
* QRL æœªå®Œæˆè¨‚å–®

---

# ğŸ§¾ æœ€å° QRL å°ˆå±¬æª”æ¡ˆç¸½è¡¨ï¼ˆä¸€å®šè¦æœ‰ï¼‰

| é¡å‹    | æª”æ¡ˆ                   |
| ----- | -------------------- |
| åƒ¹æ ¼    | `qrl_price.py`       |
| æ•¸é‡    | `qrl_quantity.py`    |
| äº¤æ˜“å°   | `qrl_usdt_pair.py`   |
| è¡Œæƒ…    | `get_qrl_price.py`   |
| ä¸‹å–®    | `place_qrl_order.py` |
| Guard | `qrl_*_guard.py`     |
| API   | `qrl_rest_client.py` |
| WS    | `qrl_ws_client.py`   |

---

# ğŸ“ å»ºè­°æª”æ¡ˆä½ç½®

```
src/app/domain/value_objects/
 â”œâ”€ qrl_price.py
 â””â”€ qrl_quantity.py
```

---

# ğŸŸ¢ `QrlPrice`ï¼ˆåƒ¹æ ¼ï¼‰

## è¦å‰‡ï¼ˆä»¥ MEXC ç¾è²¨å¸¸è¦‹è¨­å®šï¼‰

> âš ï¸ è‹¥ä½ å¯¦éš›æŸ¥åˆ° MEXC QRL/USDT ä¸åŒï¼Œ**åªè¦æ”¹å¸¸æ•¸å³å¯**

* tick sizeï¼š`0.0001`
* åƒ¹æ ¼å¿…é ˆ > 0
* è‡ªå‹•å°é½Š tickï¼ˆ**å‘ä¸‹å–æ•´ï¼Œé¿å…æ‹’å–®**ï¼‰

---

### `qrl_price.py`

```python
from decimal import Decimal, ROUND_DOWN, getcontext

getcontext().prec = 28


class QrlPrice:
    """
    QRL/USDT å°ˆç”¨åƒ¹æ ¼ Value Object
    - ä¸å¯è®Š
    - å¼·åˆ¶ tick size
    """

    TICK_SIZE = Decimal("0.0001")
    MIN_PRICE = TICK_SIZE

    def __init__(self, value: Decimal | str | float):
        self._value = self._normalize(Decimal(str(value)))

    @staticmethod
    def _normalize(value: Decimal) -> Decimal:
        if value <= 0:
            raise ValueError("QRL price must be > 0")

        # å°é½Š tick sizeï¼ˆå‘ä¸‹ï¼Œé¿å…äº¤æ˜“æ‰€ rejectï¼‰
        normalized = (
            value // QrlPrice.TICK_SIZE
        ) * QrlPrice.TICK_SIZE

        if normalized < QrlPrice.MIN_PRICE:
            raise ValueError("QRL price below minimum tick size")

        return normalized.quantize(QrlPrice.TICK_SIZE, rounding=ROUND_DOWN)

    @property
    def value(self) -> Decimal:
        return self._value

    def __str__(self) -> str:
        return format(self._value, "f")

    def __repr__(self) -> str:
        return f"QrlPrice({self._value})"

    # ---- domain helpers ----

    def multiply(self, quantity: "QrlQuantity") -> Decimal:
        """USDT é‡‘é¡"""
        return (self._value * quantity.value).quantize(
            Decimal("0.00000001"), rounding=ROUND_DOWN
        )
```

---

# ğŸŸ¢ `QrlQuantity`ï¼ˆæ•¸é‡ï¼‰

## è¦å‰‡ï¼ˆä¿å®ˆå®‰å…¨ç‰ˆï¼‰

* æœ€å°ä¸‹å–®é‡ï¼š`1 QRL`
* step sizeï¼š`1`
* ç¦æ­¢ 0 / è² æ•¸
* ç¦æ­¢å°æ•¸ï¼ˆç¾è²¨ QRL å¹¾ä¹éƒ½æ˜¯æ•´æ•¸ï¼‰

---

### `qrl_quantity.py`

```python
from decimal import Decimal, ROUND_DOWN, getcontext

getcontext().prec = 28


class QrlQuantity:
    """
    QRL å°ˆç”¨æ•¸é‡ Value Object
    - ä¸å¯è®Š
    - é˜² fat finger
    """

    STEP_SIZE = Decimal("1")
    MIN_QTY = Decimal("1")
    MAX_QTY = Decimal("1000000")  # ä¿å‘½ä¸Šé™ï¼Œå¯è‡ªè¡Œèª¿æ•´

    def __init__(self, value: Decimal | str | int | float):
        self._value = self._normalize(Decimal(str(value)))

    @staticmethod
    def _normalize(value: Decimal) -> Decimal:
        if value <= 0:
            raise ValueError("QRL quantity must be > 0")

        # å°é½Š step size
        normalized = (value // QrlQuantity.STEP_SIZE) * QrlQuantity.STEP_SIZE

        if normalized < QrlQuantity.MIN_QTY:
            raise ValueError("QRL quantity below minimum")

        if normalized > QrlQuantity.MAX_QTY:
            raise ValueError("QRL quantity exceeds safety limit")

        return normalized.quantize(QrlQuantity.STEP_SIZE, rounding=ROUND_DOWN)

    @property
    def value(self) -> Decimal:
        return self._value

    def __str__(self) -> str:
        return format(self._value, "f")

    def __repr__(self) -> str:
        return f"QrlQuantity({self._value})"
```

---

# ğŸ§ª ä½¿ç”¨ç¯„ä¾‹ï¼ˆä¸‹å–®å‰ï¼‰

```python
price = QrlPrice("0.123456")     # -> 0.1234
qty = QrlQuantity(12.7)          # -> 12

cost = price.multiply(qty)       # USDT æˆæœ¬
```

---

# ğŸ”’ ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆï¼ˆå¯¦ç›¤é‡é»ï¼‰

### âœ… ä¸ round half up

â†’ **äº¤æ˜“æ‰€æœ€æ€•ç²¾åº¦éŒ¯èª¤ï¼Œå‘ä¸‹æ°¸é æœ€å®‰å…¨**

### âœ… ä¸å…è¨± symbol / precision å¤–éƒ¨æ³¨å…¥

â†’ **é¿å…éŒ¯å¹£ã€éŒ¯å¸‚å ´**

### âœ… MAX_QTY æ˜¯ã€Œäººé¡é˜²å‘†ã€

â†’ é˜²æ­¢ `10000000` é€™ç¨® fat-finger
